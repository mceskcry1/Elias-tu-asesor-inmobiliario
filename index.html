<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SMARTHOUSE - Asesoría Inmobiliaria en Quito. Financiamiento flexible para tu hogar.">
    <meta name="keywords" content="asesor inmobiliario, casas en venta, financiamiento vivienda, Quito, SMARTHOUSE">
    <meta name="author" content="Elias Simbaña">
    <title>SmartHouse - Tu Asesor Inmobiliario de Confianza</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Encabezado -->
    <header class="site-header">
        <div class="container">
            <h1>SMARTHOUSE</h1>
            <p>Elias Simbaña Asesor Inmobiliario</p>
        </div>
    </header>

    <!-- Menú de Navegación -->
    <nav class="site-nav">
        <div class="container">
            <a href="#inicio">Inicio</a>
            <a href="#propiedades">Propiedades</a>
            <a href="#financiamiento">Financiamiento</a>
            <a href="#contacto">Contacto</a>
            <a href="#admin" id="admin-link">Admin</a>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <main class="container">
        <!-- Sección Inicio -->
        <section id="inicio" class="section">
            <h2>En SMARTHOUSE financiamos tu vivienda</h2>
            <p>Hola, soy <strong>Elias Simbaña</strong>, tu asesor inmobiliario de confianza. En <strong>SMARTHOUSE</strong>, mi misión es ayudarte a encontrar la casa de tus sueños con opciones de financiamiento accesibles y flexibles. Con años de experiencia en el sector inmobiliario, me comprometo a brindarte un servicio personalizado y transparente para que puedas tomar la mejor decisión.</p>
            <p>¿Listo para dar el primer paso hacia tu nuevo hogar? ¡Estoy aquí para ayudarte!</p>
        </section>

        <!-- Sección Propiedades -->
        <section id="propiedades" class="section">
            <h2>Propiedades Disponibles</h2>
            <p>Explora nuestras propiedades destacadas y encuentra la opción perfecta para ti. Todas las propiedades cuentan con planes de financiamiento flexibles para que puedas adquirirlas sin preocupaciones.</p>
            <div class="grid-container" id="property-grid">
                <!-- Propiedad 1 -->
                <div class="grid-item" data-id="1">
                    <img src="https://scontent.fuio5-1.fna.fbcdn.net/v/t39.30808-6/475549336_1262051411539428_6378070222689656124_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=946e27&_nc_eui2=AeGQmer3XtaMqzvDqjeJjqOYLgu-feghucwuC7596CG5zGY_G2g1L04w1p_XeP7gMLNnaQ7VLUSaxui8pxnz5FB_&_nc_ohc=_7mw8qNvVioQ7kNvgF6-_5N&_nc_oc=Adhjjsoqz8xGo1OboRDmUPJFEE9fc7b4SLatodLC13lJLEkTyDrBC2ynF4iIVY66KUQ&_nc_zt=23&_nc_ht=scontent.fuio5-1.fna&_nc_gid=AFrI08Ltkv37F1gSaj2upir&oh=00_AYBptsgelNute1K6pYYM41cXCCL4D118SIzI7UzwwJmzsw&oe=67AB3283" alt="Casa en La Armenia" class="zoomable-image clickable-image">
                    <h3>CASA INDEPENDIENTE SEMINUEVA RETIRADA POR FALTA DE PAGO (LA ARMENIA 2)</h3>
                    <p><strong>Precio:</strong> $40,000 | <strong>Cuota mensual:</strong> desde $396 | <strong>Valor de entrada:</strong> $1,720</p>
                    <div class="property-details">
                        <h4>Detalles de la Casa</h4>
                        <ul>
                            <li><strong>Habitaciones:</strong> 3</li>
                            <li><strong>Baños:</strong> 2</li>
                            <li><strong>Sala:</strong> Sí</li>
                            <li><strong>Cocina:</strong> Sí</li>
                            <li><strong>Comedor:</strong> Sí</li>
                            <li><strong>Área de máquinas:</strong> Sí</li>
                            <li><strong>Área de parqueadero:</strong> Sí</li>
                        </ul>
                    </div>
                    <button class="status-button" data-status="available">Aún Disponible</button>
                    <a href="#" class="cta-button">Ver detalles</a>
                </div>
                <!-- Propiedad 2 -->
                <div class="grid-item" data-id="2">
                    <img src="https://scontent.fuio5-1.fna.fbcdn.net/v/t39.30808-6/475833590_1261385264939376_2792949908644325600_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=946e27&_nc_eui2=AeE3qIOeGukdwkvJWUIDo8OB3s8iksdUkhPezyKSx1SSE-MwE1UZPLcKNyb1ELIcv1sHW2OuLdz9qIkdPjALBMGr&_nc_ohc=IP348y8nXGEQ7kNvgEm4eC7&_nc_oc=AdiyRJpSVBpEZBfqwxHIpFTMjARqUmcUdMj6YNNWq2r4MlVX4DjCfFreqLBrVQ5oQW4&_nc_zt=23&_nc_ht=scontent.fuio5-1.fna&_nc_gid=ArniMcGXRAxe6QyapPVOVEY&oh=00_AYBP-5PeVyKjXfDa1X5TnTS4qo2ANRj78GGJkUeDMK5KDg&oe=67AB4C78" alt="Casa en Quito" class="zoomable-image clickable-image">
                    <h3>SE VENDE HERMOSA CASA A CUOTAS EN QUITO CON TODAS LAS COMUNIDADES Y CON FACILIDAD DE PAGO</h3>
                    <p><strong>Precio:</strong> $80,000 | <strong>Cuota mensual:</strong> desde $793 | <strong>Valor de entrada:</strong> $3,000</p>
                    <div class="property-details">
                        <h4>Detalles de la Casa</h4>
                        <p><strong>Área de terreno:</strong> 553 m²</p>
                        <p><strong>Área de construcción:</strong> 209 m²</p>
                        <h5>Distribución</h5>
                        <h6>Planta Baja</h6>
                        <h6>Interior:</h6>
                        <ul>
                            <li>Sala, comedor, cocina</li>
                            <li>Estudio</li>
                            <li>Dormitorio con baño completo</li>
                            <li>Sala de estar</li>
                            <li>Chimenea</li>
                        </ul>
                        <h6>Exterior:</h6>
                        <ul>
                            <li>Áreas verdes</li>
                            <li>Bodega</li>
                            <li>Zona BBQ</li>
                            <li>Horno de leña</li>
                            <li>Juegos infantiles</li>
                            <li>Parqueadero para 4 vehículos</li>
                        </ul>
                        <h6>Segunda Planta</h6>
                        <ul>
                            <li>Dos dormitorios con baño completo compartido</li>
                            <li>Dormitorio máster con baño completo</li>
                            <li>Dormitorio con baño completo</li>
                            <li>Balcón</li>
                        </ul>
                    </div>
                    <button class="status-button" data-status="available">Aún Disponible</button>
                    <a href="#" class="cta-button">Ver detalles</a>
                </div>
            </div>
        </section>

        <!-- Modal para Ampliar Imagen -->
        <div id="image-modal" class="modal">
            <span class="close">&times;</span>
            <div class="image-container">
                <img class="modal-content" id="modal-image">
            </div>
        </div>

        <!-- Sección Financiamiento -->
        <section id="financiamiento" class="section">
            <h2>¿Cómo Funciona el Financiamiento?</h2>
            <p>En <strong>SmartHouse</strong>, entendemos que comprar una vivienda es una de las decisiones más importantes de tu vida. Por eso, ofrecemos planes de financiamiento diseñados para adaptarse a tus necesidades:</p>
            <ul>
                <li><strong>Cuotas accesibles:</strong> Paga cómodamente en cuotas mensuales que se ajustan a tu presupuesto.</li>
                <li><strong>Tasas competitivas:</strong> Trabajamos con tasas de interés justas y transparentes.</li>
                <li><strong>Proceso rápido:</strong> Simplificamos los trámites para que obtengas tu vivienda en el menor tiempo posible.</li>
                <li><strong>Asesoría personalizada:</strong> Estoy contigo en cada paso del proceso para resolver tus dudas y guiarte.</li>
            </ul>
            <p>No dejes que la falta de liquidez te impida cumplir tu sueño de tener un hogar propio. ¡Contáctame hoy mismo para explorar las opciones disponibles!</p>
        </section>

        <!-- Sección Contacto -->
        <section id="contacto" class="section">
            <h2>Contacto</h2>
            <p>¿Tienes preguntas o deseas más información? Completa el siguiente formulario y me pondré en contacto contigo lo antes posible. También puedes llamarme directamente al <strong>+593 999 999 999</strong>.</p>
            <form action="mailto:tucorreo@example.com" method="post" enctype="text/plain">
                <input type="text" name="nombre" placeholder="Tu nombre" required>
                <input type="email" name="email" placeholder="Tu correo electrónico" required>
                <input type="tel" name="telefono" placeholder="Tu teléfono" required>
                <textarea name="mensaje" rows="5" placeholder="Escribe tu mensaje"></textarea>
                <button type="submit" class="cta-button">Enviar</button>
            </form>
        </section>

        <!-- Sección Admin -->
        <section id="admin" class="section" style="display: none;">
            <h2>Añadir Nueva Propiedad</h2>
            <form id="admin-form">
                <label for="password">Contraseña de Administrador:</label>
                <input type="password" id="password" required>
                <button type="button" id="login-btn">Ingresar</button>
            </form>
            <form id="add-property-form" style="display: none;">
                <h3>Nueva Propiedad</h3>
                <label for="image-url">URL de la Imagen:</label>
                <input type="url" id="image-url" required>
                <label for="title">Título de la Propiedad:</label>
                <input type="text" id="title" required>
                <label for="price">Precio:</label>
                <input type="text" id="price" required>
                <label for="monthly-payment">Cuota Mensual:</label>
                <input type="text" id="monthly-payment" required>
                <label for="down-payment">Valor de Entrada:</label>
                <input type="text" id="down-payment" required>
                <label for="details">Detalles de la Casa (separados por comas):</label>
                <textarea id="details" required></textarea>
                <button type="button" id="save-property-btn">Guardar Propiedad</button>
            </form>
        </section>
    </main>

    <!-- Pie de Página -->
    <footer class="site-footer">
        <div class="container">
            <p>&copy; 2023 ELIAS SIMBAÑA - Todos los derechos reservados. | Diseñado por <a href="#">Elias Simbaña</a></p>
        </div>
    </footer>

    <!-- Script para Zoom, Mover Imagen, Estado y Admin -->
    <script>
        // Modal para Ampliar Imagen
        const modal = document.getElementById('image-modal');
        const modalImage = document.getElementById('modal-image');
        const closeBtn = document.querySelector('.close');
        const imageContainer = document.querySelector('.image-container');

        let isDragging = false;
        let startX, startY, scrollLeft, scrollTop;

        // Abrir modal al hacer clic en una imagen
        document.querySelectorAll('.clickable-image').forEach(image => {
            image.addEventListener('click', () => {
                modal.style.display = 'block';
                modalImage.src = image.src;
            });
        });

        // Cerrar modal al hacer clic en la "X"
        closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        // Cerrar modal al hacer clic fuera de la imagen
        window.addEventListener('click', (event) => {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });

        // Zoom en Imagen dentro del Modal
        let scale = 1; // Escala inicial
        modalImage.addEventListener('wheel', (event) => {
            event.preventDefault(); // Evitar el scroll normal
            const delta = event.deltaY > 0 ? -0.1 : 0.1; // Detectar dirección del scroll
            scale += delta;

            // Limitar el zoom entre 1x y 3x
            scale = Math.min(Math.max(1, scale), 3);

            // Aplicar la transformación de escala
            modalImage.style.transform = `scale(${scale})`;
        });

        // Mover Imagen dentro del Modal
        imageContainer.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.pageX - imageContainer.scrollLeft;
            startY = e.pageY - imageContainer.scrollTop;
        });

        imageContainer.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            e.preventDefault();
            imageContainer.scrollLeft = startX - e.pageX;
            imageContainer.scrollTop = startY - e.pageY;
        });

        imageContainer.addEventListener('mouseup', () => {
            isDragging = false;
        });

        imageContainer.addEventListener('mouseleave', () => {
            isDragging = false;
        });

        // Panel de Administración
        const adminSection = document.getElementById('admin');
        const loginForm = document.getElementById('admin-form');
        const addPropertyForm = document.getElementById('add-property-form');
        const loginBtn = document.getElementById('login-btn');
        const savePropertyBtn = document.getElementById('save-property-btn');
        const propertyGrid = document.getElementById('property-grid');

        // Mostrar formulario de administrador
        document.getElementById('admin-link').addEventListener('click', (e) => {
            e.preventDefault();
            adminSection.style.display = 'block';
        });

        // Validar contraseña usando el backend
        loginBtn.addEventListener('click', async () => {
            const password = document.getElementById('password').value;

            // Enviar la contraseña al backend
            const response = await fetch('http://localhost:3000/api/auth', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password }),
            });

            const result = await response.json();
            if (result.success) {
                alert("Autenticación exitosa");
                loginForm.style.display = 'none';
                addPropertyForm.style.display = 'block';
            } else {
                alert("Contraseña incorrecta. Inténtalo de nuevo.");
            }
        });

        // Guardar nueva propiedad
        savePropertyBtn.addEventListener('click', () => {
            const imageUrl = document.getElementById('image-url').value;
            const title = document.getElementById('title').value;
            const price = document.getElementById('price').value;
            const monthlyPayment = document.getElementById('monthly-payment').value;
            const downPayment = document.getElementById('down-payment').value;
            const details = document.getElementById('details').value.split(',');

            // Crear nueva propiedad
            const newProperty = document.createElement('div');
            newProperty.classList.add('grid-item');
            newProperty.setAttribute('data-id', Date.now()); // ID único
            newProperty.innerHTML = `
                <img src="${imageUrl}" alt="${title}" class="zoomable-image clickable-image">
                <h3>${title}</h3>
                <p><strong>Precio:</strong> ${price} | <strong>Cuota mensual:</strong> ${monthlyPayment} | <strong>Valor de entrada:</strong> ${downPayment}</p>
                <div class="property-details">
                    <h4>Detalles de la Casa</h4>
                    <ul>
                        ${details.map(detail => `<li>${detail.trim()}</li>`).join('')}
                    </ul>
                </div>
                <button class="status-button" data-status="available">Aún Disponible</button>
                <a href="#" class="cta-button">Ver detalles</a>
            `;

            // Agregar al grid
            propertyGrid.appendChild(newProperty);

            // Limpiar formulario
            addPropertyForm.reset();

            // Guardar en localStorage
            const properties = JSON.parse(localStorage.getItem('properties')) || [];
            properties.push({
                id: newProperty.getAttribute('data-id'),
                imageUrl,
                title,
                price,
                monthlyPayment,
                downPayment,
                details,
                status: 'available'
            });
            localStorage.setItem('properties', JSON.stringify(properties));

            alert("Propiedad añadida con éxito.");
        });

        // Cargar propiedades guardadas
        window.addEventListener('load', () => {
            const savedProperties = JSON.parse(localStorage.getItem('properties')) || [];
            savedProperties.forEach(property => {
                const newProperty = document.createElement('div');
                newProperty.classList.add('grid-item');
                newProperty.setAttribute('data-id', property.id);
                newProperty.innerHTML = `
                    <img src="${property.imageUrl}" alt="${property.title}" class="zoomable-image clickable-image">
                    <h3>${property.title}</h3>
                    <p><strong>Precio:</strong> ${property.price} | <strong>Cuota mensual:</strong> ${property.monthlyPayment} | <strong>Valor de entrada:</strong> ${property.downPayment}</p>
                    <div class="property-details">
                        <h4>Detalles de la Casa</h4>
                        <ul>
                            ${property.details.map(detail => `<li>${detail.trim()}</li>`).join('')}
                        </ul>
                    </div>
                    <button class="status-button" data-status="${property.status}">
                        ${property.status === 'available' ? 'Aún Disponible' : 'No Disponible'}
                    </button>
                    <a href="#" class="cta-button">Ver detalles</a>
                `;
                propertyGrid.appendChild(newProperty);
            });

            // Manejar clic en botones de estado
            document.querySelectorAll('.status-button').forEach(button => {
                button.addEventListener('click', async () => {
                    const token = localStorage.getItem('authToken'); // Obtener el token guardado
                    if (!token) {
                        alert("Debes iniciar sesión como administrador.");
                        return;
                    }

                    // Verificar el token con el backend
                    const response = await fetch('http://localhost:3000/api/verify-token', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ token }),
                    });

                    const result = await response.json();
                    if (!result.success) {
                        alert("No tienes permiso para realizar esta acción.");
                        return;
                    }

                    // Cambiar el estado de la propiedad
                    const propertyId = button.closest('.grid-item').getAttribute('data-id');
                    const properties = JSON.parse(localStorage.getItem('properties')) || [];
                    const propertyIndex = properties.findIndex(prop => prop.id == propertyId);

                    if (propertyIndex !== -1) {
                        const currentStatus = properties[propertyIndex].status;
                        const newStatus = currentStatus === 'available' ? 'unavailable' : 'available';
                        properties[propertyIndex].status = newStatus;

                        // Actualizar localStorage
                        localStorage.setItem('properties', JSON.stringify(properties));

                        // Actualizar texto del botón
                        button.textContent = newStatus === 'available' ? 'Aún Disponible' : 'No Disponible';
                        button.setAttribute('data-status', newStatus);

                        alert(`Estado actualizado a: ${newStatus === 'available' ? 'Aún Disponible' : 'No Disponible'}`);
                    }
                });
            });
        });
    </script>
</body>
</html>